//@version=4
//@SoftKill21
strategy(title="CRYPTO HA Strategy", shorttitle="CRYPTO HA Strategy", overlay=true , default_qty_type =strategy.percent_of_equity, default_qty_value =100, commission_type= strategy.commission.percent,commission_value =0.1 )


ma1_len = input(50)
ma2_len = input(100)

fromDay = input(defval = 1, title = "From Day", minval = 1, maxval = 31)
fromMonth = input(defval = 1, title = "From Month", minval = 1, maxval = 12)
fromYear = input(defval = 2020, title = "From Year", minval = 1970)
 //monday and session 
// To Date Inputs
toDay = input(defval = 31, title = "To Day", minval = 1, maxval = 31)
toMonth = input(defval = 12, title = "To Month", minval = 1, maxval = 12)
toYear = input(defval = 2020, title = "To Year", minval = 1970)

startDate = timestamp(fromYear, fromMonth, fromDay, 00, 00)
finishDate = timestamp(toYear, toMonth, toDay, 00, 00)
time_cond = time >= startDate and time <= finishDate 


//First Moving Average data
o = ema(open, ma1_len)
c = ema(close, ma1_len)
h = ema(high, ma1_len)
l = ema(low, ma1_len)

// === HA calculator ===
ha_t = heikinashi(syminfo.tickerid)
ha_o = security(ha_t, timeframe.period, o)
ha_c = security(ha_t, timeframe.period, c)
ha_h = security(ha_t, timeframe.period, h)
ha_l = security(ha_t, timeframe.period, l)

//Second Moving Average data

o2 = ema(ha_o, ma2_len)
c2 = ema(ha_c, ma2_len)
h2 = ema(ha_h, ma2_len)
l2 = ema(ha_l, ma2_len)

// === Color def ===
ha_col = o2 > c2 ? color.white : color.lime

sell = o2 > c2 and o2[1] < c2[1] and time_cond
buy = o2 < c2 and o2[1] > c2[1] and time_cond
plotshape(buy, color=color.green, text= "Buy", location= location.belowbar,style= shape.labelup, textcolor=color.white, size = size.tiny, title="Buy Alert",editable=false, transp=60)
plotshape(sell, color=color.red, text= "Sell", location= location.abovebar,style= shape.labeldown, textcolor=color.white, size = size.tiny, title="Sell Alert", editable=false, transp=60)

trendColor = buy ? color.red : sell ? color.green : na
plot( buy ? close: sell  ? close : na , color=trendColor, style=plot.style_line, linewidth=4, editable=false)



onlylong=input(true)
original=input(false)

if(onlylong)
    strategy.entry("long",1,when=buy)
    strategy.close("long",when=sell)
if(original)
    strategy.entry("long",1,when=buy)
    strategy.entry("short",0,when=sell)

sl = input(0.075)
strategy.exit("closelong", "long" , loss = close * sl / syminfo.mintick, alert_message = "sl point")
strategy.exit("closeshort", "short" , loss = close * sl / syminfo.mintick, alert_message = "sl point")


---------------------------------------

//@version=4
strategy("BarUpDn Strategy", overlay=true, default_qty_type = strategy.percent_of_equity, default_qty_value = 10, precision = 6)
// Issue long/short on bar up/dn and gap conditions.
enterLong  = close > open and open > close[1]
enterShort = close < open and open < close[1]
if enterLong
    // On the close of the bar, place order for long entry and 
    strategy.entry("Long executed", strategy.long)
    alert("Long order placed")
if enterShort
    strategy.entry("Short executed", strategy.short)
    alert("Short order placed")

changeInProfits = change(strategy.netprofit)
lastPercentProfit = changeInProfits ? 100 * (changeInProfits / strategy.position_size[1]) / strategy.position_avg_price[1] : na
plotchar(lastPercentProfit, "lastPercentProfit", "", location.top, size = size.tiny)

// For validation
plotchar(strategy.netprofit, "strategy.netprofit", "", location.top, size = size.tiny)
plotchar(strategy.position_size, "strategy.position_size", "", location.top, size = size.tiny)
plotchar(strategy.position_avg_price, "strategy.position_avg_price", "", location.top, size = size.tiny)

---------------------------------------
//@version=3
strategy(title='Super Simple Martingale Crossover', shorttitle="MartiMcFly",overlay=true, slippage=5, commission_type=strategy.commission.cash_per_contract, commission_value=0.00007, initial_capital=1000, currency=currency.USD)
src = close
//Moving average definition (for crossover)
fastEMA = ema(src, input(title="Fast EMA Period", defval=8))
slowEMA = ema(src, input(title="Slow EMA Period", defval=62))
//Take Profit and Stop Loss settings in points
TP = input(defval=1000, step=10, title='Take Profit (points)')
SL = input(defval=500, step=10, title='Stop Loss (points')
win_mult = input(defval=1.00, type=float, step=0.05, title='Multiplier for Winning Streak')
loss_mult = input(defval=1.7, type=float, step=0.05, title='Multiplier for Losing Streak')
//Just hedge the last trade lmao
dir = 0.0
dir := na(dir[1]) ? 1 : crossunder(fastEMA, slowEMA) and dir[1] > 0 ? -1 : crossover(fastEMA, slowEMA) and dir[1] < 0 ? 1 : dir[1]
//Count the current streak of winning/losing trades
calcWinMult(mult) => 
    result = 0.0
    result := na(result[1]) ? 1 : change(strategy.losstrades) > 0 ? 1 : change(strategy.wintrades) > 0 or change(strategy.eventrades) > 0 ? nz(result[1]) * mult : nz(result[1])
calcLossMult(mult) => 
    result = 0.0
    result := na(result[1]) ? 1 : change(strategy.wintrades) > 0 ? 1 : change(strategy.losstrades) > 0 or change(strategy.eventrades) > 0 ? nz(result[1]) * mult : nz(result[1])
//Gett the type of trade we need
type = 0.0
type := change(strategy.wintrades) > 0 ? 1 : change(strategy.losstrades) > 0 ? -1 : nz(type[1], 1)
//Get the martingale multiplier for the nex trade
qtyMult = type > 0 ? calcWinMult(win_mult) : calcLossMult(loss_mult)
//Basic buy/sell signals
buy = dir > 0 and strategy.opentrades < 1
sell = dir < 0 and strategy.opentrades < 1
//EMA plots
plot(fastEMA, color=red, linewidth=2)
plot(slowEMA, color=orange, linewidth=2)
lots = input(defval=0.01, title='Min Lot Size')*100000
adjustedLots = lots * qtyMult
if(strategy.equity > strategy.initial_capital * 0.2 and (strategy.closedtrades + strategy.opentrades) < 1499)
    strategy.entry('LONG', strategy.long, qty=adjustedLots, when=buy)
    strategy.entry('SHORT', strategy.short, qty=adjustedLots, when=sell)
    strategy.exit('L.exit', from_entry='LONG', profit=TP, loss=SL)
    strategy.exit('S.exit', from_entry='SHORT', profit=TP, loss=SL)

======================================


